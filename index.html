<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Will you be my Valentine?</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a cute look -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #ffe4e6; /* Soft pink background */
            /* Prevent scrolling so the button doesn't run off-screen */
            overflow: hidden; 
        }
        
        .btn-shadow {
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-shadow:active {
            transform: scale(0.95);
        }

        /* Crucial Fix: 
           We do NOT set position: absolute initially. 
           We let JS handle the switch to 'fixed' when it moves.
        */
        #noBtn {
            transition: top 0.3s ease, left 0.3s ease; /* Smooth gliding effect */
        }

        /* Loading Spinner */
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #f43f5e;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col items-center justify-center relative bg-pink-100">

    <!-- MAIN CARD CONTAINER -->
    <div id="mainContainer" class="text-center z-10 p-5 max-w-md w-full flex flex-col items-center">
        
        <!-- GIF IMAGE -->
        <!-- Updated to a more reliable URL -->
        <img id="gifImage" 
             src="https://media.tenor.com/I7kd0jR0aXUAAAAi/mocha-bear-hearts.gif" 
             alt="Cute Bear" 
             class="w-48 h-48 object-contain mb-6 rounded-lg hover:scale-105 transition-transform duration-300">

        <!-- TITLE TEXT -->
        <!-- Updated Name to Brok -->
        <h1 id="questionText" class="text-3xl md:text-4xl font-extrabold text-rose-600 mb-8 leading-tight">
            Brok, will you be my Valentine?
        </h1>

        <!-- BUTTONS CONTAINER -->
        <div class="flex flex-row gap-6 items-center justify-center w-full relative min-h-[4rem] mb-4">
            
            <!-- YES BUTTON -->
            <button id="yesBtn" onclick="acceptProposal()" 
                    class="btn-shadow bg-rose-500 hover:bg-rose-600 text-white font-bold py-3 px-8 rounded-full text-xl z-20 transition-all duration-200">
                Yes
            </button>

            <!-- NO BUTTON -->
            <button id="noBtn" onmouseover="moveButton()" ontouchstart="moveButton()" 
                    class="btn-shadow bg-white text-rose-500 border-2 border-rose-200 font-bold py-3 px-8 rounded-full text-xl z-30">
                No
            </button>
        </div>

        <!-- AI FEATURES CONTAINER -->
        <div class="w-full mt-4 flex flex-col items-center gap-3">
            
            <!-- FEATURE 1: CONVINCE ME -->
            <button id="convinceBtn" onclick="askCupid()" 
                    class="text-rose-400 hover:text-rose-600 text-sm font-semibold underline decoration-dotted underline-offset-4 transition-colors">
                Convince me why I should? ‚ú®
            </button>

            <!-- FEATURE 2: DATE PLANNER -->
            <button id="datePlanBtn" onclick="planDate()" 
                    class="hidden bg-white border-2 border-rose-400 text-rose-500 hover:bg-rose-50 font-bold py-2 px-6 rounded-full shadow-sm transition-colors mt-4">
                Plan our First Date! ‚ú®
            </button>

            <!-- AI RESPONSE BOX -->
            <div id="aiResponse" class="hidden mt-4 p-4 bg-white/80 backdrop-blur-sm rounded-xl border border-rose-100 shadow-sm text-rose-700 text-sm w-full max-w-xs transition-all duration-300">
                <!-- Content injected here -->
            </div>

            <!-- Error Message Box -->
            <div id="errorBox" class="hidden mt-2 text-red-500 text-xs text-center px-4"></div>
        </div>

        <!-- FUNNY CAPTION -->
        <p id="subText" class="mt-8 text-rose-400 text-sm font-semibold opacity-0 transition-opacity duration-500">
            "No" seems a bit shy... üôà
        </p>

    </div>

    <!-- SCRIPT LOGIC -->
    <script>
        // --- CONFIGURATION ---
        // Your API Key has been added here
        const apiKey = "AIzaSyBk1vTKQOQ-fgdUjodzN8S_dZltxAH43iA"; 

        // --- DOM ELEMENTS ---
        const noBtn = document.getElementById('noBtn');
        const yesBtn = document.getElementById('yesBtn');
        const questionText = document.getElementById('questionText');
        const gifImage = document.getElementById('gifImage');
        const subText = document.getElementById('subText');
        const convinceBtn = document.getElementById('convinceBtn');
        const datePlanBtn = document.getElementById('datePlanBtn');
        const aiResponse = document.getElementById('aiResponse');
        const errorBox = document.getElementById('errorBox');

        let moveCount = 0;

        // --- GEMINI API HELPER ---
        async function callGemini(prompt) {
            if (!apiKey) {
                showError("API Key is missing! Add your Gemini API key in the code.");
                return null;
            }

            try {
                // Show loading state
                aiResponse.innerHTML = '<div class="loader"></div> Thinking...';
                aiResponse.classList.remove('hidden');
                errorBox.classList.add('hidden');

                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{ text: prompt }]
                            }]
                        })
                    }
                );

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                return text;

            } catch (error) {
                console.error("Gemini Error:", error);
                showError("Cupid is having trouble connecting... try again!");
                aiResponse.classList.add('hidden');
                return null;
            }
        }

        function showError(msg) {
            errorBox.innerText = msg;
            errorBox.classList.remove('hidden');
        }

        // --- FEATURE 1: ASK CUPID (Convince Me) ---
        async function askCupid() {
            convinceBtn.disabled = true;
            // Customized prompt for Brok
            const prompt = "Give me one funny, specific, and charming reason why Brok should say YES to being my Valentine. Be witty, cute, and brief (under 20 words). Use an emoji.";
            
            const result = await callGemini(prompt);
            
            if (result) {
                aiResponse.innerHTML = `<span class="font-bold">üíò Cupid says:</span><br>"${result}"`;
            }
            convinceBtn.disabled = false;
        }

        // --- FEATURE 2: DATE PLANNER ---
        async function planDate() {
            datePlanBtn.disabled = true;
            datePlanBtn.innerText = "Planning... ‚ú®";

            const prompt = "Create a short, cute, 3-step date night plan for a new Valentine's couple. Keep it wholesome and romantic. Use emojis for each step. Keep it under 50 words total.";

            const result = await callGemini(prompt);

            if (result) {
                const formattedResult = result.replace(/\n/g, '<br>');
                aiResponse.innerHTML = `<span class="font-bold">üìÖ Date Plan:</span><br>${formattedResult}`;
                aiResponse.classList.remove('hidden');
            }

            datePlanBtn.innerText = "Plan another! ‚ú®";
            datePlanBtn.disabled = false;
        }


        // --- CORE LOGIC (Move Button / Accept) ---

        function moveButton() {
            moveCount++;
            
            if (moveCount === 1) {
                subText.classList.remove('opacity-0');
            }

            // Change to fixed so it can move anywhere
            noBtn.style.position = 'fixed';

            const maxWidth = window.innerWidth - noBtn.offsetWidth - 20;
            const maxHeight = window.innerHeight - noBtn.offsetHeight - 20;

            const randomX = Math.floor(Math.random() * maxWidth);
            const randomY = Math.floor(Math.random() * maxHeight);

            noBtn.style.left = randomX + 'px';
            noBtn.style.top = randomY + 'px';
        }

        function acceptProposal() {
            // 1. Fire Confetti
            fireConfetti();

            // 2. Change Text
            questionText.innerHTML = "YAY! I knew it! ‚ù§Ô∏èü•≥";
            questionText.className = "text-4xl md:text-5xl font-extrabold text-rose-600 mb-6 animate-bounce";

            // 3. Change Image to Success GIF
            // Updated to a reliable kissing bear gif
            gifImage.src = "https://media.tenor.com/gUiu1zyxfzYAAAAi/bear-kiss-bear-kisses.gif";
            gifImage.className = "w-64 h-64 object-contain mb-6 rounded-lg shadow-xl ring-4 ring-rose-200";

            // 4. Update Buttons - Hiding them
            yesBtn.style.display = 'none';
            noBtn.style.display = 'none';
            subText.style.display = 'none';
            convinceBtn.style.display = 'none';
            
            // 5. Show Post-Acceptance AI Button
            datePlanBtn.classList.remove('hidden');
            
            aiResponse.classList.add('hidden');
            aiResponse.innerHTML = '';

            // 6. Confetti Loop
            let duration = 3 * 1000;
            let end = Date.now() + duration;

            (function frame() {
                confetti({
                    particleCount: 5,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: ['#ff0000', '#ffa500', '#ffff00', '#008000', '#0000ff', '#4b0082', '#ee82ee']
                });
                confetti({
                    particleCount: 5,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: ['#ff0000', '#ffa500', '#ffff00', '#008000', '#0000ff', '#4b0082', '#ee82ee']
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());
        }

        function fireConfetti() {
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 }
            });
        }
    </script>
</body>
</html>
